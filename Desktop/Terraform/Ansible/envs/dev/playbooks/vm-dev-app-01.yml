---
- name: Create dev Linux app VM (no public IP; with data disk)
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    vm_name: dev-app-01
    vm_size: Standard_D2s_v5
    os_type: Linux
    admin_username: azureuser
    # fetch password securely from Azure Key Vault at runtime
    admin_password: >-
      {{ lookup('azure.azcollection.azure_keyvault_secret',
                'dev-app-01-localadmin',
                vault_url=key_vault_url) }}
    data_disk_lun: 0
    data_disk_size_gb: 128
    managed_disk_type: Premium_LRS

  roles:
    - role: azure_vm
``